{"version":3,"file":"bundle.js","sources":["../src/create_element.js","../src/utils.js","../src/create_vdom.js","../src/render.js","../src/constants.js","../src/diff.js","../src/patch.js","../src/example.js"],"sourcesContent":["// 参考 React 实现一个精简版的 createElement 方法\n\nfunction createElement(type, props, children) {\n  let element = {\n    key: (props && props.key) || null,\n    type: type,\n    props: props ? props : {},\n    children: children || []\n  };\n\n\n  let count = 0;\n\n  element.children.forEach((child, i) => {\n    count++;\n  });\n\n  element.count = count;\n\n  return element;\n}\n\nexport default createElement;\n","let utils = {};\n\nutils.isType = (type, target) => {\n  return Object.prototype.toString.call(target) === `[object ${type}]`;\n};\n\n['String', 'Boolean', 'Number', 'Array', 'Function', 'Object', 'Date', 'RegExp', 'Error'].forEach(type => {\n  utils[`is${type}`] = (target) => utils.isType(type, target);\n});\n\n\n// props 中关于 html 属性的处理\n// 暂时只处理一部分，仅供演示\n// 注意 className、内联样式 style\nutils.setAttrs = (el, props) => {\n  for (let key in props) {\n    if (['id', 'href', 'value'].indexOf(key) !== -1) {\n      el.setAttribute(key, props[key])\n    }\n    if (key === 'className') {\n      el.setAttribute('class', props['className']);\n    }\n    if (key === 'style') {\n      for (let p in props.style) {\n        el.style[p] = props.style[p];\n      }\n    }\n  }\n};\n\nexport default utils;\n","import utils from './utils';\n\n\nfunction createVdom(element) {\n  let { type, props, children } = element;\n\n  // type 类型判断，按照 React 的套路，可能是html标签、文本、函数、React组件，\n  // 这里暂时只处理html标签及文本的情况\n  // jsx 解析后文本为字符串，html标签会解析为对象\n\n  let el = document.createElement(type);\n  utils.setAttrs(el, props);\n\n  if (!children) {\n    return el;\n  }\n\n  children.forEach(child => {\n    let elChild;\n    if (utils.isString(child)) {\n      elChild = document.createTextNode(child);\n    }\n    if (utils.isObject(child)) {\n      elChild = createVdom(child);\n    }\n    el.appendChild(elChild);\n  });\n\n  return el;\n}\n\nexport default createVdom;\n","function render(vdom, el) {\n  el.appendChild(vdom)\n}\n\nexport default render;\n","// patchType 替换节点\nexport const REPLACE = 'REPLACE';\n\n// patchType 重新排列节点\nexport const REORDER = 'REORDER';\n\n// patchType 属性修改\nexport const PROPS = 'PROPS';\n\n// patchType 文本修改\nexport const TEXT = 'TEXT';\n","import utils from './utils';\nimport { REPLACE, REORDER, PROPS, TEXT } from './constants';\n\nfunction diff(node, newNode) {\n  let index = 0;\n  let patches = {};\n\n  diffNode(node, newNode, index, patches);\n\n  return patches;\n}\n\nfunction diffNode(node, newNode, index, patches) {\n  let currentPatch = [];\n\n  if (!newNode) {\n    // console.log('!newNode ', node);\n    return;\n  }\n\n  if (utils.isString(node) && utils.isString(newNode)) {\n    if (node !== newNode) {\n      currentPatch.push({\n        type: TEXT,\n        content: newNode\n      });\n    }\n  } else if (newNode.type === node.type && newNode.key === node.key) {\n    let propsPatches = diffProps(node.props, newNode.props);\n\n    if (Object.keys(propsPatches).length) {\n      currentPatch.push({\n        type: PROPS,\n        props: propsPatches\n      });\n    }\n\n    diffChildren(node.children, newNode.children, index, patches, currentPatch);\n\n  } else {\n    currentPatch.push({\n      type: REPLACE,\n      node: newNode\n    });\n  }\n  // console.log('currentPatch: ', currentPatch);\n  // console.log('patches: ', index);\n  if (currentPatch.length) {\n    patches[index] = currentPatch;\n  }\n}\n\nfunction diffProps(props, newProps) {\n  let propsPatches = {};\n\n  for (const key in props) {\n    if (newProps[key] !== props[key]) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  for (const key in newProps) {\n    if (!props.hasOwnProperty(key)) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  return propsPatches;\n}\n\nfunction diffChildren(children, newChildren, index, patches, currentPatch) {\n  let diffs = diffNodes(children, newChildren);\n  // console.log(diffs);\n  newChildren = diffs.nodes;\n\n  if (diffs.moves.length) {\n    currentPatch.push({\n      type: REORDER,\n      moves: diffs.moves\n    });\n  }\n\n  let leftNode = null;\n  let currentNodeIndex = index;\n  children.forEach((child, i) => {\n    let newChild = newChildren[i];\n    currentNodeIndex = (leftNode && leftNode.count)\n      ? currentNodeIndex + leftNode.count + 1\n      : currentNodeIndex + 1;\n    diffNode(child, newChild, currentNodeIndex, patches);\n    leftNode = child;\n  });\n}\n\nfunction diffNodes(nodes, newNodes) {\n  // if (!nodes || !newNodes) {\n  //   console.log(nodes, newNodes);\n  // }\n\n  let keyMap = buildKeyMap(nodes);\n  let newKeyMap = buildKeyMap(newNodes);\n\n  let _nodes = [];\n  let moves = [];\n\n  let nodeIndex = 0;\n  nodes.forEach(item => {\n    const key = item.key\n    if (key) {\n      if (!newKeyMap.hasOwnProperty(key)) {\n        _nodes.push(null);\n      } else {\n        _nodes.push(newNodes[key]);\n      }\n    } else {\n      _nodes.push(newNodes[nodeIndex++] || null);\n    }\n  });\n\n  // console.log(oldMap);\n  // console.log(_nodes);\n\n  _nodes.forEach((item, i) => {\n    if (item === null) {\n      moves.push(remove(i));\n      _nodes.splice(i, 1);\n    }\n  });\n\n  // console.log('-----');\n\n\n  let j = 0;\n  newNodes.forEach((item, i) => {\n    let key = item.key;\n    let _nodeItem = _nodes[j];\n    if (_nodeItem) {\n      let _nodeKey = _nodeItem.key;\n      if (_nodeKey === item.key) {\n        j++;\n      } else {\n        if (!keyMap.hasOwnProperty(key)) {\n          moves.push(insert(i, item));\n        } else {\n          let nextKey = _nodes[j + 1].key;\n          if (nextKey === key) {\n            moves.push(remove(i));\n            _nodes.splice(j, 1);\n            j++;\n          } else {\n            moves.push(insert(i, item));\n          }\n        }\n      }\n    } else {\n      moves.push(insert(i, item));\n    }\n  });\n\n  // console.log(_nodes);\n  // console.log(moves);\n  return {\n    moves,\n    nodes: _nodes\n  };\n}\n\nfunction remove(i) {\n  return {\n    index: i,\n    type: REPLACE\n  };\n}\n\nfunction insert(i, item) {\n  return {\n    index: i,\n    item,\n    type: REORDER\n  };\n}\n\nfunction buildKeyMap(elements) {\n  let keyMap = {};\n\n  elements.forEach((item, i) => {\n    if (item.key) {\n      keyMap[item.key] = i;\n    }\n  });\n\n  return keyMap;\n}\n\n\nexport default diff;\n","import utils from './utils';\nimport { REPLACE, REORDER, PROPS, TEXT } from './constants';\nimport createVdom from './create_vdom';\n\nfunction patch(root, patches) {\n  let steps = { index: 0 };\n  let index = 0;\n\n  patchNode(root, steps, patches, index);\n}\n\nfunction patchNode(node, steps, patches) {\n  let currentPatch = patches[steps.index];\n\n  if (currentPatch) {\n    applyPatches(node, currentPatch);\n  }\n\n  node.childNodes.forEach(child => {\n    steps.index++;\n    // console.log(steps, child);\n    patchNode(child, steps, patches)\n  });\n}\n\nfunction applyPatches(node, patch) {\n  patch.forEach(item => {\n    switch(item.type) {\n      case REPLACE:\n        // console.log(node, item.node, 'replace');\n        let newNode = utils.isString(item.node)\n          ? document.createTextNode(item.node)\n          : createVdom(item.node);\n        node.parentNode.replaceChild(newNode, node);\n        break;\n      case REORDER:\n        // console.log(node, item.moves, 'reorder');\n        reorderChildren(node, item.moves);\n        break;\n      case PROPS:\n        // console.log(node, item.props, 'props');\n        utils.setAttrs(node, item.props);\n        break;\n      case TEXT:\n        node.nodeValue = item.content;\n        break;\n      default:\n        throw new Error(`Unknown patch type ${item.type}`);\n    }\n  });\n}\n\nfunction reorderChildren(node, moves) {\n  const nodeList = [].slice.call(node.childNodes);\n  let maps = {};\n\n  nodeList.forEach(item => {\n    if (node.nodeType === 1) {\n      let key = node.getAttribute('key');\n      if (key) {\n        maps[key] = node;\n      }\n    }\n  });\n\n  moves.forEach(move => {\n    let index = move.index;\n    if (move.type === REPLACE) {\n      if (nodeList[index] === node.childNodes[index]) {\n        node.removeChild(node.childNodes[index]);\n      }\n      nodeList.splice(index, 1);\n    } else if (move.type === REORDER) {\n      let insertNode = maps[move.item.key]\n        ? maps[move.item.key].cloneNode(true)\n        : (typeof move.item === 'object')\n          ? createVdom(move.item)\n          : document.createTextNode(move.item);\n      nodeList.splice(index, 0, insertNode);\n      node.insertBefore(insertNode, node.childNodes[index] || null);\n    }\n  });\n}\n\nexport default patch;\n","import {\n  createElement,\n  createVdom,\n  render,\n  diff,\n  patch\n} from './index';\n\n// jsx 被 babel 编译后会转化为 createElement 的形式，\nlet elements = createElement('div', { id: 'box' }, [\n  createElement('p', { className: 'message', style: { color: '#36f' } }, ['hello walker']),\n  createElement('ul', { className: 'lists' }, [\n    createElement('li', null, [`Item 1`]),\n    createElement('li', null, [`Item 2`]),\n    createElement('li', null, [`Item 3`])\n  ])\n]);\n\n\nconsole.log('elements: ', elements);\n\nlet vdom = createVdom(elements);\n\nconsole.log('vdom: ', vdom);\n\nrender(vdom, document.getElementById('app'));\n\n\n/*\nlet newElements = createElement('div', { className: 'new-box', id: 'box' }, [\n  createElement('h1', { id: 'title' }, ['This is title']),\n  createElement('p', { style: { color: '#f80' } }, ['hello walker, nice to meet you']),\n  createElement('ul', { className: 'lists new-lists' }, [\n    createElement('li', null, [`Item 1`]),\n    createElement('li', null, [`Item 4`]),\n  ])\n]);\n\nlet patches = diff(elements, newElements);\n\nconsole.log('patches: ', patches);\n\npatch(vdom, patches);\n*/\n\nlet count = 0;\n\nfunction createEl() {\n\n  let items = [];\n\n  for(let i = 0; i < count; i++) {\n    items.push(createElement('li', null, [`Item ${i}`]));\n  }\n\n  let color = (count % 2 === 0) ? '#36f': '#f80';\n\n  return createElement('div', { className: 'new-box', id: 'box' }, [\n    createElement('h1', { id: 'title' }, ['This is title']),\n    createElement('p', { style: { color: color } }, [`hello walker, nice to meet you ${count}`]),\n    createElement('ul', { className: 'lists new-lists' }, items)\n  ]);\n}\n\nfunction renderTest() {\n  let newElements = createEl();\n  let patches = diff(elements, newElements);\n  console.log('patches: ', patches);\n  patch(vdom, patches);\n  elements = newElements;\n}\n\n\ndocument.getElementById('btn-start').onclick = function () {\n  count = 0;\n  renderTest();\n};\n\ndocument.getElementById('btn-add').onclick = function () {\n  count++;\n  renderTest();\n};\n\ndocument.getElementById('btn-remove').onclick = function () {\n  count--;\n  if (count < 0) count = 0;\n  renderTest();\n};\n\n\n\n\n"],"names":["createElement","type","props","children","element","key","count","forEach","child","i","utils","isType","target","Object","prototype","toString","call","setAttrs","el","indexOf","setAttribute","p","style","createVdom","document","elChild","isString","createTextNode","isObject","appendChild","render","vdom","REPLACE","REORDER","PROPS","TEXT","diff","node","newNode","index","patches","diffNode","currentPatch","push","content","propsPatches","diffProps","keys","length","diffChildren","newProps","hasOwnProperty","newChildren","diffs","diffNodes","nodes","moves","leftNode","currentNodeIndex","newChild","newNodes","keyMap","buildKeyMap","newKeyMap","_nodes","nodeIndex","item","remove","splice","j","_nodeItem","_nodeKey","insert","nextKey","elements","patch","root","steps","patchNode","applyPatches","childNodes","parentNode","replaceChild","reorderChildren","nodeValue","Error","nodeList","slice","maps","nodeType","getAttribute","move","removeChild","insertNode","cloneNode","insertBefore","id","className","color","console","log","getElementById","createEl","items","renderTest","newElements","onclick"],"mappings":"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"}
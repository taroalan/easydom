{"version":3,"file":"bundle.js","sources":["../src/utils.js","../src/create_vnode.js","../src/create_element.js","../src/render.js","../src/constants.js","../src/diff.js","../src/patch.js","../src/example.js"],"sourcesContent":["let utils = {};\n\nutils.isType = (type, target) => {\n  return Object.prototype.toString.call(target) === `[object ${type}]`;\n};\n\n['String', 'Boolean', 'Number', 'Array', 'Function', 'Object', 'Date', 'RegExp', 'Error'].forEach(type => {\n  utils[`is${type}`] = (target) => utils.isType(type, target);\n});\n\n\n// props 中关于 html 属性的处理\n// 暂时只处理一部分，仅供演示\n// 注意 className、内联样式 style\nutils.setAttrs = (el, props) => {\n  for (let key in props) {\n    if (['id', 'href', 'value'].indexOf(key) !== -1) {\n      el.setAttribute(key, props[key])\n    }\n    if (key === 'className') {\n      el.setAttribute('class', props['className']);\n    }\n    if (key === 'style') {\n      for (let p in props.style) {\n        el.style[p] = props.style[p];\n      }\n    }\n  }\n};\n\nexport default utils;\n","// 参考 React 实现一个精简版的 createVNode 方法\n// babel plugin: jsx to vnode\n// https://babeljs.io/docs/en/next/babel-plugin-transform-react-jsx.html\n\nimport utils from './utils';\n\nfunction createVNode(type, props, ...children) {\n\n  let vnode = {\n    key: (props && props.key) || null,\n    type: type,\n    props: props ? props : {},\n    children\n  };\n\n  let count = 0;\n\n  vnode.children.forEach((child) => {\n    count++;\n  });\n\n  // 标记当前节点下面有几个子节点\n  vnode.count = count;\n\n  return vnode;\n}\n\nexport default createVNode;\n","import utils from './utils';\n\n\nfunction createElement(vnode) {\n  let { type, props, children } = vnode;\n\n  // type 类型判断，按照 React 的套路，可能是html标签(String)、函数(Function)、React组件(Component)，\n  // 这里暂时只处理html标签及文本的情况\n  // jsx 解析后文本为字符串(不再有子节点) children: ['text']\n  // html标签会解析为对象(需要再去查看子节点) { type: 'div', props: { id: 'container' }, children: [...]}\n\n  if (utils.isString(vnode)) {\n    return document.createTextNode(vnode);\n  }\n\n  let el = document.createElement(type);\n  utils.setAttrs(el, props);\n\n  if (!children) {\n    return el;\n  }\n\n  // 常规写法:\n  children.forEach(child => {\n    el.appendChild(createElement(child));\n  });\n\n  // 精简写法:\n  // let appendChild = el.appendChild.bind(el);\n  // children.map(createElement).map(appendChild);\n\n  return el;\n}\n\nexport default createElement;\n","function render(vdom, el) {\n  el.appendChild(vdom)\n}\n\nexport default render;\n","// 删除节点\nexport const REMOVE = 'REMOVE';\n\n// 插入节点\nexport const INSERT = 'INSERT';\n\n// patchType 替换节点\nexport const REPLACE = 'REPLACE';\n\n// patchType 重新排列节点\nexport const REORDER = 'REORDER';\n\n// patchType 属性修改\nexport const PROPS = 'PROPS';\n\n// patchType 文本修改\nexport const TEXT = 'TEXT';\n","import utils from './utils';\nimport { REPLACE, REORDER, PROPS, TEXT } from './constants';\n\nfunction diff(tree, newTree) {\n  let index = 0;\n  let patches = {};\n\n  diffNode(tree, newTree, index, patches);\n\n  return patches;\n}\n\nfunction diffNode(node, newNode, index, patches) {\n  let currentPatch = [];\n\n  if (!newNode) {\n    // console.log('!newNode ', node);\n    return;\n  }\n\n  if (utils.isString(node) && utils.isString(newNode)) {\n    if (node !== newNode) {\n      currentPatch.push({\n        type: TEXT,\n        content: newNode\n      });\n    }\n  } else if (newNode.type === node.type && newNode.key === node.key) {\n    let propsPatches = diffProps(node.props, newNode.props);\n\n    if (Object.keys(propsPatches).length) {\n      currentPatch.push({\n        type: PROPS,\n        props: propsPatches\n      });\n    }\n\n    diffChildren(node.children, newNode.children, index, patches, currentPatch);\n\n  } else {\n    currentPatch.push({\n      type: REPLACE,\n      node: newNode\n    });\n  }\n  // console.log('currentPatch: ', currentPatch);\n  // console.log('patches: ', index);\n  if (currentPatch.length) {\n    patches[index] = currentPatch;\n  }\n}\n\nfunction diffProps(props, newProps) {\n  let propsPatches = {};\n\n  for (const key in props) {\n    if (newProps[key] !== props[key]) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  for (const key in newProps) {\n    if (!props.hasOwnProperty(key)) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  return propsPatches;\n}\n\nfunction diffChildren(children, newChildren, index, patches, currentPatch) {\n  let diffs = diffNodes(children, newChildren);\n  // console.log(diffs);\n  newChildren = diffs.nodes;\n\n  if (diffs.moves.length) {\n    currentPatch.push({\n      type: REORDER,\n      moves: diffs.moves\n    });\n  }\n\n  let leftNode = null;\n  let currentNodeIndex = index;\n  children.forEach((child, i) => {\n    let newChild = newChildren[i];\n    currentNodeIndex = (leftNode && leftNode.count)\n      ? currentNodeIndex + leftNode.count + 1\n      : currentNodeIndex + 1;\n    diffNode(child, newChild, currentNodeIndex, patches);\n    leftNode = child;\n  });\n}\n\nfunction diffNodes(nodes, newNodes) {\n  // if (!nodes || !newNodes) {\n  //   console.log(nodes, newNodes);\n  // }\n\n  let keyMap = buildKeyMap(nodes);\n  let newKeyMap = buildKeyMap(newNodes);\n\n  let _nodes = [];\n  let moves = [];\n\n  let nodeIndex = 0;\n  nodes.forEach(item => {\n    const key = item.key\n    if (key) {\n      if (!newKeyMap.hasOwnProperty(key)) {\n        _nodes.push(null);\n      } else {\n        _nodes.push(newNodes[key]);\n      }\n    } else {\n      _nodes.push(newNodes[nodeIndex++] || null);\n    }\n  });\n\n  // console.log(oldMap);\n  // console.log(_nodes);\n\n  _nodes.forEach((item, i) => {\n    if (item === null) {\n      moves.push(remove(i));\n      _nodes.splice(i, 1);\n    }\n  });\n\n  // console.log('-----');\n\n\n  let j = 0;\n  newNodes.forEach((item, i) => {\n    let key = item.key;\n    let _nodeItem = _nodes[j];\n    if (_nodeItem) {\n      let _nodeKey = _nodeItem.key;\n      if (_nodeKey === item.key) {\n        j++;\n      } else {\n        if (!keyMap.hasOwnProperty(key)) {\n          moves.push(insert(i, item));\n        } else {\n          let nextKey = _nodes[j + 1].key;\n          if (nextKey === key) {\n            moves.push(remove(i));\n            _nodes.splice(j, 1);\n            j++;\n          } else {\n            moves.push(insert(i, item));\n          }\n        }\n      }\n    } else {\n      moves.push(insert(i, item));\n    }\n  });\n\n  // console.log(_nodes);\n  // console.log(moves);\n  return {\n    moves,\n    nodes: _nodes\n  };\n}\n\nfunction remove(i) {\n  return {\n    index: i,\n    type: REPLACE\n  };\n}\n\nfunction insert(i, item) {\n  return {\n    index: i,\n    item,\n    type: REORDER\n  };\n}\n\nfunction buildKeyMap(elements) {\n  let keyMap = {};\n\n  elements.forEach((item, i) => {\n    if (item.key) {\n      keyMap[item.key] = i;\n    }\n  });\n\n  return keyMap;\n}\n\n\nexport default diff;\n","import utils from './utils';\nimport { REPLACE, REORDER, PROPS, TEXT } from './constants';\nimport createElement from './create_element';\n\nfunction patch(root, patches) {\n  let steps = { index: 0 };\n  let index = 0;\n\n  patchNode(root, steps, patches, index);\n}\n\nfunction patchNode(node, steps, patches) {\n  let currentPatch = patches[steps.index];\n\n  if (currentPatch) {\n    applyPatches(node, currentPatch);\n  }\n\n  node.childNodes.forEach(child => {\n    steps.index++;\n    // console.log(steps, child);\n    patchNode(child, steps, patches)\n  });\n}\n\nfunction applyPatches(node, patch) {\n  patch.forEach(item => {\n    switch(item.type) {\n      case REPLACE:\n        // console.log(node, item.node, 'replace');\n        let newNode = utils.isString(item.node)\n          ? document.createTextNode(item.node)\n          : createElement(item.node);\n        node.parentNode.replaceChild(newNode, node);\n        break;\n      case REORDER:\n        // console.log(node, item.moves, 'reorder');\n        reorderChildren(node, item.moves);\n        break;\n      case PROPS:\n        // console.log(node, item.props, 'props');\n        utils.setAttrs(node, item.props);\n        break;\n      case TEXT:\n        node.nodeValue = item.content;\n        break;\n      default:\n        throw new Error(`Unknown patch type ${item.type}`);\n    }\n  });\n}\n\nfunction reorderChildren(node, moves) {\n  const nodeList = [].slice.call(node.childNodes);\n  let maps = {};\n\n  nodeList.forEach(item => {\n    if (node.nodeType === 1) {\n      let key = node.getAttribute('key');\n      if (key) {\n        maps[key] = node;\n      }\n    }\n  });\n\n  moves.forEach(move => {\n    let index = move.index;\n    if (move.type === REPLACE) {\n      if (nodeList[index] === node.childNodes[index]) {\n        node.removeChild(node.childNodes[index]);\n      }\n      nodeList.splice(index, 1);\n    } else if (move.type === REORDER) {\n      let insertNode = maps[move.item.key]\n        ? maps[move.item.key].cloneNode(true)\n        : (typeof move.item === 'object')\n          ? createElement(move.item)\n          : document.createTextNode(move.item);\n      nodeList.splice(index, 0, insertNode);\n      node.insertBefore(insertNode, node.childNodes[index] || null);\n    }\n  });\n}\n\nexport default patch;\n","import {\n  createVNode,\n  createElement,\n  render,\n  diff,\n  patch\n} from './index';\n\n// jsx 被 babel 编译后的格式\nlet vtree = createVNode('div', { id: 'box' },\n  createVNode('p', { className: 'message', style: { color: '#36f' } }, 'hello walker'),\n  createVNode('ul', { className: 'lists' },\n    createVNode('li', null, 'Item 1'),\n    createVNode('li', null, 'Item 2'),\n    createVNode('li', null, 'Item 3')\n  )\n);\n\nconsole.log('vtree: ', vtree);\n\nlet rootNode = createElement(vtree);\n\nconsole.log('rootNode: ', rootNode);\n\nrender(rootNode, document.getElementById('app'));\n\n\n/*\nlet newVtree = createVNode('div', { className: 'new-box', id: 'box' },\n  createVNode('h1', { id: 'title' }, 'This is title'),\n  createVNode('p', { style: { color: '#f80' } }, 'hello walker, nice to meet you'),\n  createVNode('ul', { className: 'lists new-lists' },\n    createVNode('li', null, 'Item 1'),\n    createVNode('li', null, 'Item 4'),\n  )\n);\n\nlet patches = diff(vtree, newVtree);\n\nconsole.log('patches: ', patches);\n\npatch(rootNode, patches);\n*/\n\n// test jsx\n// let vdom1 = (\n//   <div class=\"box\">\n//     <p>1</p>\n//     <span>666</span>\n//     <ul>\n//       <li>item1</li>\n//       <li>item1</li>\n//       <li>item1</li>\n//     </ul>\n//   </div>\n// );\n// console.log(vdom1);\n\n\n\nlet count = 0;\n\nfunction createVtree() {\n\n  let items = [];\n\n  for(let i = 0; i < count; i++) {\n    items.push(createVNode('li', null, `Item ${i}`));\n  }\n\n  let color = (count % 2 === 0) ? '#36f': '#f80';\n\n  return createVNode('div', { className: 'new-box', id: 'box' },\n    createVNode('h1', { id: 'title' }, 'This is title'),\n    createVNode('p', { style: { color: color } }, `hello walker, nice to meet you ${count}`),\n    createVNode('ul', { className: 'lists new-lists' }, ...items)\n  );\n}\n\nfunction renderTest() {\n  let newVtree = createVtree();\n  let patches = diff(vtree, newVtree);\n  console.log('patches: ', patches);\n  patch(rootNode, patches);\n  vtree = newVtree;\n}\n\n\ndocument.getElementById('btn-start').onclick = function () {\n  count = 0;\n  renderTest();\n};\n\ndocument.getElementById('btn-add').onclick = function () {\n  count++;\n  renderTest();\n};\n\ndocument.getElementById('btn-remove').onclick = function () {\n  count--;\n  if (count < 0) count = 0;\n  renderTest();\n};\n\n\n"],"names":["utils","isType","type","target","Object","prototype","toString","call","forEach","setAttrs","el","props","key","indexOf","setAttribute","p","style","createVNode","children","vnode","count","child","createElement","isString","document","createTextNode","appendChild","render","vdom","REPLACE","REORDER","PROPS","TEXT","diff","tree","newTree","index","patches","diffNode","node","newNode","currentPatch","push","content","propsPatches","diffProps","keys","length","diffChildren","newProps","hasOwnProperty","newChildren","diffs","diffNodes","nodes","moves","leftNode","currentNodeIndex","i","newChild","newNodes","keyMap","buildKeyMap","newKeyMap","_nodes","nodeIndex","item","remove","splice","j","_nodeItem","_nodeKey","insert","nextKey","elements","patch","root","steps","patchNode","applyPatches","childNodes","parentNode","replaceChild","reorderChildren","nodeValue","Error","nodeList","slice","maps","nodeType","getAttribute","move","removeChild","insertNode","cloneNode","insertBefore","vtree","id","className","color","console","log","rootNode","getElementById","createVtree","items","renderTest","newVtree","onclick"],"mappings":"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"}
{"version":3,"file":"bundle.js","sources":["../src/create_vnode.js","../src/utils.js","../src/create_element.js","../src/render.js","../src/constants.js","../src/diff.js","../src/patch.js","../src/example.js"],"sourcesContent":["// 参考 React 实现一个精简版的 createVNode 方法\n\nfunction createVNode(type, props, children) {\n  let vnode = {\n    key: (props && props.key) || null,\n    type: type,\n    props: props ? props : {},\n    children: children || []\n  };\n\n  let count = 0;\n\n  vnode.children.forEach((child, i) => {\n    count++;\n  });\n\n  vnode.count = count;\n\n  return vnode;\n}\n\nexport default createVNode;\n","let utils = {};\n\nutils.isType = (type, target) => {\n  return Object.prototype.toString.call(target) === `[object ${type}]`;\n};\n\n['String', 'Boolean', 'Number', 'Array', 'Function', 'Object', 'Date', 'RegExp', 'Error'].forEach(type => {\n  utils[`is${type}`] = (target) => utils.isType(type, target);\n});\n\n\n// props 中关于 html 属性的处理\n// 暂时只处理一部分，仅供演示\n// 注意 className、内联样式 style\nutils.setAttrs = (el, props) => {\n  for (let key in props) {\n    if (['id', 'href', 'value'].indexOf(key) !== -1) {\n      el.setAttribute(key, props[key])\n    }\n    if (key === 'className') {\n      el.setAttribute('class', props['className']);\n    }\n    if (key === 'style') {\n      for (let p in props.style) {\n        el.style[p] = props.style[p];\n      }\n    }\n  }\n};\n\nexport default utils;\n","import utils from './utils';\n\n\nfunction createElement(vnode) {\n  let { type, props, children } = vnode;\n\n  // type 类型判断，按照 React 的套路，可能是html标签、文本、函数、React组件，\n  // 这里暂时只处理html标签及文本的情况\n  // jsx 解析后文本为字符串，html标签会解析为对象\n\n  let el = document.createElement(type);\n  utils.setAttrs(el, props);\n\n  if (!children) {\n    return el;\n  }\n\n  children.forEach(child => {\n    let elChild;\n    if (utils.isString(child)) {\n      elChild = document.createTextNode(child);\n    }\n    if (utils.isObject(child)) {\n      elChild = createElement(child);\n    }\n    el.appendChild(elChild);\n  });\n\n  return el;\n}\n\nexport default createElement;\n","function render(vdom, el) {\n  el.appendChild(vdom)\n}\n\nexport default render;\n","// patchType 替换节点\nexport const REPLACE = 'REPLACE';\n\n// patchType 重新排列节点\nexport const REORDER = 'REORDER';\n\n// patchType 属性修改\nexport const PROPS = 'PROPS';\n\n// patchType 文本修改\nexport const TEXT = 'TEXT';\n","import utils from './utils';\nimport { REPLACE, REORDER, PROPS, TEXT } from './constants';\n\nfunction diff(tree, newTree) {\n  let index = 0;\n  let patches = {};\n\n  diffNode(tree, newTree, index, patches);\n\n  return patches;\n}\n\nfunction diffNode(node, newNode, index, patches) {\n  let currentPatch = [];\n\n  if (!newNode) {\n    // console.log('!newNode ', node);\n    return;\n  }\n\n  if (utils.isString(node) && utils.isString(newNode)) {\n    if (node !== newNode) {\n      currentPatch.push({\n        type: TEXT,\n        content: newNode\n      });\n    }\n  } else if (newNode.type === node.type && newNode.key === node.key) {\n    let propsPatches = diffProps(node.props, newNode.props);\n\n    if (Object.keys(propsPatches).length) {\n      currentPatch.push({\n        type: PROPS,\n        props: propsPatches\n      });\n    }\n\n    diffChildren(node.children, newNode.children, index, patches, currentPatch);\n\n  } else {\n    currentPatch.push({\n      type: REPLACE,\n      node: newNode\n    });\n  }\n  // console.log('currentPatch: ', currentPatch);\n  // console.log('patches: ', index);\n  if (currentPatch.length) {\n    patches[index] = currentPatch;\n  }\n}\n\nfunction diffProps(props, newProps) {\n  let propsPatches = {};\n\n  for (const key in props) {\n    if (newProps[key] !== props[key]) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  for (const key in newProps) {\n    if (!props.hasOwnProperty(key)) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  return propsPatches;\n}\n\nfunction diffChildren(children, newChildren, index, patches, currentPatch) {\n  let diffs = diffNodes(children, newChildren);\n  // console.log(diffs);\n  newChildren = diffs.nodes;\n\n  if (diffs.moves.length) {\n    currentPatch.push({\n      type: REORDER,\n      moves: diffs.moves\n    });\n  }\n\n  let leftNode = null;\n  let currentNodeIndex = index;\n  children.forEach((child, i) => {\n    let newChild = newChildren[i];\n    currentNodeIndex = (leftNode && leftNode.count)\n      ? currentNodeIndex + leftNode.count + 1\n      : currentNodeIndex + 1;\n    diffNode(child, newChild, currentNodeIndex, patches);\n    leftNode = child;\n  });\n}\n\nfunction diffNodes(nodes, newNodes) {\n  // if (!nodes || !newNodes) {\n  //   console.log(nodes, newNodes);\n  // }\n\n  let keyMap = buildKeyMap(nodes);\n  let newKeyMap = buildKeyMap(newNodes);\n\n  let _nodes = [];\n  let moves = [];\n\n  let nodeIndex = 0;\n  nodes.forEach(item => {\n    const key = item.key\n    if (key) {\n      if (!newKeyMap.hasOwnProperty(key)) {\n        _nodes.push(null);\n      } else {\n        _nodes.push(newNodes[key]);\n      }\n    } else {\n      _nodes.push(newNodes[nodeIndex++] || null);\n    }\n  });\n\n  // console.log(oldMap);\n  // console.log(_nodes);\n\n  _nodes.forEach((item, i) => {\n    if (item === null) {\n      moves.push(remove(i));\n      _nodes.splice(i, 1);\n    }\n  });\n\n  // console.log('-----');\n\n\n  let j = 0;\n  newNodes.forEach((item, i) => {\n    let key = item.key;\n    let _nodeItem = _nodes[j];\n    if (_nodeItem) {\n      let _nodeKey = _nodeItem.key;\n      if (_nodeKey === item.key) {\n        j++;\n      } else {\n        if (!keyMap.hasOwnProperty(key)) {\n          moves.push(insert(i, item));\n        } else {\n          let nextKey = _nodes[j + 1].key;\n          if (nextKey === key) {\n            moves.push(remove(i));\n            _nodes.splice(j, 1);\n            j++;\n          } else {\n            moves.push(insert(i, item));\n          }\n        }\n      }\n    } else {\n      moves.push(insert(i, item));\n    }\n  });\n\n  // console.log(_nodes);\n  // console.log(moves);\n  return {\n    moves,\n    nodes: _nodes\n  };\n}\n\nfunction remove(i) {\n  return {\n    index: i,\n    type: REPLACE\n  };\n}\n\nfunction insert(i, item) {\n  return {\n    index: i,\n    item,\n    type: REORDER\n  };\n}\n\nfunction buildKeyMap(elements) {\n  let keyMap = {};\n\n  elements.forEach((item, i) => {\n    if (item.key) {\n      keyMap[item.key] = i;\n    }\n  });\n\n  return keyMap;\n}\n\n\nexport default diff;\n","import utils from './utils';\nimport { REPLACE, REORDER, PROPS, TEXT } from './constants';\nimport createElement from './create_element';\n\nfunction patch(root, patches) {\n  let steps = { index: 0 };\n  let index = 0;\n\n  patchNode(root, steps, patches, index);\n}\n\nfunction patchNode(node, steps, patches) {\n  let currentPatch = patches[steps.index];\n\n  if (currentPatch) {\n    applyPatches(node, currentPatch);\n  }\n\n  node.childNodes.forEach(child => {\n    steps.index++;\n    // console.log(steps, child);\n    patchNode(child, steps, patches)\n  });\n}\n\nfunction applyPatches(node, patch) {\n  patch.forEach(item => {\n    switch(item.type) {\n      case REPLACE:\n        // console.log(node, item.node, 'replace');\n        let newNode = utils.isString(item.node)\n          ? document.createTextNode(item.node)\n          : createElement(item.node);\n        node.parentNode.replaceChild(newNode, node);\n        break;\n      case REORDER:\n        // console.log(node, item.moves, 'reorder');\n        reorderChildren(node, item.moves);\n        break;\n      case PROPS:\n        // console.log(node, item.props, 'props');\n        utils.setAttrs(node, item.props);\n        break;\n      case TEXT:\n        node.nodeValue = item.content;\n        break;\n      default:\n        throw new Error(`Unknown patch type ${item.type}`);\n    }\n  });\n}\n\nfunction reorderChildren(node, moves) {\n  const nodeList = [].slice.call(node.childNodes);\n  let maps = {};\n\n  nodeList.forEach(item => {\n    if (node.nodeType === 1) {\n      let key = node.getAttribute('key');\n      if (key) {\n        maps[key] = node;\n      }\n    }\n  });\n\n  moves.forEach(move => {\n    let index = move.index;\n    if (move.type === REPLACE) {\n      if (nodeList[index] === node.childNodes[index]) {\n        node.removeChild(node.childNodes[index]);\n      }\n      nodeList.splice(index, 1);\n    } else if (move.type === REORDER) {\n      let insertNode = maps[move.item.key]\n        ? maps[move.item.key].cloneNode(true)\n        : (typeof move.item === 'object')\n          ? createElement(move.item)\n          : document.createTextNode(move.item);\n      nodeList.splice(index, 0, insertNode);\n      node.insertBefore(insertNode, node.childNodes[index] || null);\n    }\n  });\n}\n\nexport default patch;\n","import {\n  createVNode,\n  createElement,\n  render,\n  diff,\n  patch\n} from './index';\n\n// jsx 被 babel 编译后的格式\nlet vtree = createVNode('div', { id: 'box' }, [\n  createVNode('p', { className: 'message', style: { color: '#36f' } }, ['hello walker']),\n  createVNode('ul', { className: 'lists' }, [\n    createVNode('li', null, [`Item 1`]),\n    createVNode('li', null, [`Item 2`]),\n    createVNode('li', null, [`Item 3`])\n  ])\n]);\n\nconsole.log('vtree: ', vtree);\n\nlet rootNode = createElement(vtree);\n\nconsole.log('rootNode: ', rootNode);\n\nrender(rootNode, document.getElementById('app'));\n\n\n/*\nlet newVtree = createVNode('div', { className: 'new-box', id: 'box' }, [\n  createVNode('h1', { id: 'title' }, ['This is title']),\n  createVNode('p', { style: { color: '#f80' } }, ['hello walker, nice to meet you']),\n  createVNode('ul', { className: 'lists new-lists' }, [\n    createVNode('li', null, [`Item 1`]),\n    createVNode('li', null, [`Item 4`]),\n  ])\n]);\n\nlet patches = diff(vtree, newVtree);\n\nconsole.log('patches: ', patches);\n\npatch(rootNode, patches);\n*/\n\n\nlet count = 0;\n\nfunction createVtree() {\n\n  let items = [];\n\n  for(let i = 0; i < count; i++) {\n    items.push(createVNode('li', null, [`Item ${i}`]));\n  }\n\n  let color = (count % 2 === 0) ? '#36f': '#f80';\n\n  return createVNode('div', { className: 'new-box', id: 'box' }, [\n    createVNode('h1', { id: 'title' }, ['This is title']),\n    createVNode('p', { style: { color: color } }, [`hello walker, nice to meet you ${count}`]),\n    createVNode('ul', { className: 'lists new-lists' }, items)\n  ]);\n}\n\nfunction renderTest() {\n  let newVtree = createVtree();\n  let patches = diff(vtree, newVtree);\n  console.log('patches: ', patches);\n  patch(rootNode, patches);\n  vtree = newVtree;\n}\n\n\ndocument.getElementById('btn-start').onclick = function () {\n  count = 0;\n  renderTest();\n};\n\ndocument.getElementById('btn-add').onclick = function () {\n  count++;\n  renderTest();\n};\n\ndocument.getElementById('btn-remove').onclick = function () {\n  count--;\n  if (count < 0) count = 0;\n  renderTest();\n};\n\n\n"],"names":["createVNode","type","props","children","vnode","key","count","forEach","child","i","utils","isType","target","Object","prototype","toString","call","setAttrs","el","indexOf","setAttribute","p","style","createElement","document","elChild","isString","createTextNode","isObject","appendChild","render","vdom","REPLACE","REORDER","PROPS","TEXT","diff","tree","newTree","index","patches","diffNode","node","newNode","currentPatch","push","content","propsPatches","diffProps","keys","length","diffChildren","newProps","hasOwnProperty","newChildren","diffs","diffNodes","nodes","moves","leftNode","currentNodeIndex","newChild","newNodes","keyMap","buildKeyMap","newKeyMap","_nodes","nodeIndex","item","remove","splice","j","_nodeItem","_nodeKey","insert","nextKey","elements","patch","root","steps","patchNode","applyPatches","childNodes","parentNode","replaceChild","reorderChildren","nodeValue","Error","nodeList","slice","maps","nodeType","getAttribute","move","removeChild","insertNode","cloneNode","insertBefore","vtree","id","className","color","console","log","rootNode","getElementById","createVtree","items","renderTest","newVtree","onclick"],"mappings":"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"}
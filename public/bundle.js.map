{"version":3,"file":"bundle.js","sources":["../src/utils.js","../src/create_vnode.js","../src/create_element.js","../src/render.js","../src/constants.js","../src/diff.js","../src/patch.js","../src/example.js"],"sourcesContent":["let utils = {};\n\nutils.isType = (type, target) => {\n  return Object.prototype.toString.call(target) === `[object ${type}]`;\n};\n\n['String', 'Boolean', 'Number', 'Array', 'Function', 'Object', 'Date', 'RegExp', 'Error', 'Null'].forEach(type => {\n  utils[`is${type}`] = (target) => utils.isType(type, target);\n});\n\n\n// props 中关于 html 属性的处理\n// 暂时只处理一部分，仅供演示\n// 注意 className、内联样式 style\nutils.setAttrs = (el, props) => {\n  for (let key in props) {\n    if (['id', 'href', 'value'].indexOf(key) !== -1) {\n      el.setAttribute(key, props[key])\n    }\n    if (key === 'className') {\n      el.setAttribute('class', props['className']);\n    }\n    if (key === 'style') {\n      for (let p in props.style) {\n        el.style[p] = props.style[p];\n      }\n    }\n  }\n};\n\nexport default utils;\n","// 参考 React 实现一个精简版的 createVNode 方法\n// babel plugin: jsx to vnode\n// https://babeljs.io/docs/en/next/babel-plugin-transform-react-jsx.html\n\nimport utils from './utils';\n\nfunction createVNode(type, props, ...children) {\n\n  // 嵌套 children 的特殊处理，二维变一维\n  // jsx 被 babel-plugin-transform-react-jsx 编译后的一种情况\n  if (children.length === 1 && utils.isArray(children[0])) {\n    children = !children[0].length ? [] : children[0];\n  }\n\n  let vnode = {\n    key: (props && props.key) || null,\n    type: type,\n    props: props ? props : {},\n    children\n  };\n\n  return vnode;\n}\n\nexport default createVNode;\n","import utils from './utils';\n\n\nfunction createElement(vnode) {\n  if (utils.isNull(vnode)) {\n    return document.createTextNode('');\n  }\n\n  let { type, props, children } = vnode;\n\n  // type 类型判断，按照 React 的套路，可能是html标签(String)、函数(Function)、React组件(Component)，\n  // 这里暂时只处理html标签及文本的情况\n  // jsx 解析后文本为字符串(不再有子节点) children: ['text']\n  // html标签会解析为对象(需要再去查看子节点) { type: 'div', props: { id: 'container' }, children: [...]}\n\n  if (utils.isString(vnode)) {\n    return document.createTextNode(vnode);\n  }\n\n  let el = document.createElement(type);\n  utils.setAttrs(el, props);\n\n  if (!children) {\n    return el;\n  }\n\n  // 常规写法:\n  // children.forEach(child => {\n  //   el.appendChild(createElement(child));\n  // });\n\n  // 精简写法:\n  let appendChild = el.appendChild.bind(el);\n  children.map(createElement).map(appendChild);\n\n  return el;\n}\n\nexport default createElement;\n","function render(vdom, el) {\n  el.appendChild(vdom)\n}\n\nexport default render;\n","// 删除节点\nexport const REMOVE = 'REMOVE';\n\n// 插入节点\nexport const INSERT = 'INSERT';\n\n// patchType 替换节点\nexport const REPLACE = 'REPLACE';\n\n// patchType 重新排列节点\nexport const REORDER = 'REORDER';\n\n// patchType 属性修改\nexport const PROPS = 'PROPS';\n\n// patchType 文本修改\nexport const TEXT = 'TEXT';\n","import utils from './utils';\nimport { REMOVE, INSERT, PROPS, TEXT, REPLACE, REORDER,  } from './constants';\n\nfunction diff(tree, newTree) {\n  // console.log('diff');\n  let index = 0;\n  let patches = {};\n\n  return diffNode(tree, newTree, index, patches);\n}\n\nfunction diffNode(oldNode, newNode, index, patches) {\n  // let patches = {};\n  let currentPatch = [];\n\n  // console.log(`DIFF STEPS: ${index}: `, oldNode, newNode);\n\n  if (!newNode) {\n    // 这种情况归并到 REORDER 里去处理\n    // currentPatch.push({\n    //   type: REMOVE\n    // });\n  } else if (utils.isString(oldNode) && utils.isString(newNode)) {\n    if (oldNode !== newNode) {\n      currentPatch.push({\n        type: TEXT,\n        content: newNode\n      });\n    }\n  } else if (oldNode && newNode && oldNode.type === newNode.type && oldNode.key === newNode.key) {\n    let propsPatches = diffProps(oldNode.props, newNode.props);\n\n    if (Object.keys(propsPatches).length) {\n      currentPatch.push({\n        type: PROPS,\n        props: propsPatches\n      });\n    }\n\n    // 对比子节点\n    // todo\n    diffChildren(oldNode.children, newNode.children, index, patches, currentPatch);\n\n  } else {\n    currentPatch.push({\n      type: REPLACE,\n      node: newNode\n    });\n  }\n\n  // console.log(`GOTO patchs[index] -- ${index}`);\n\n  if (currentPatch.length) {\n    // console.log(patches);\n    patches[index] = currentPatch;\n  }\n\n  return patches;\n}\n\nfunction diffChildren(oldChildren, newChildren, index, patches, currentPatch) {\n  // console.log('oldChildren, newChildren: ', oldChildren, newChildren);\n  let diffs = diffList(oldChildren, newChildren);\n\n  // console.log(diffs);\n\n  if (diffs.moves.length) {\n    currentPatch.push({\n      type: REORDER,\n      moves: diffs.moves\n    });\n  }\n\n  newChildren = diffs.nodes;\n\n  let count = 0;\n  for (var i = 0; i < oldChildren.length || i < newChildren.length; i++) {\n    let oldNode = oldChildren[i];\n    let newNode = newChildren[i];\n    // console.log(`i -- index -- count : ${i}-${index}-${count}`);\n    // count++;\n    index++;\n    diffNode(oldNode, newNode, i + index, patches);\n  }\n}\n\nfunction diffList(oldList, newList) {\n  let moves = [];\n  let nodes = [];\n\n  oldList.forEach((item, i) => {\n    let newItem = newList[i] || null;\n    nodes.push(newItem);\n  });\n\n  // console.log(nodes);\n\n  // 去除 null\n  nodes.forEach((node, i) => {\n    if (node === null) {\n      moves.push({\n        index: i,\n        type: REPLACE\n      });\n      nodes.splice(i, 1);\n    }\n  });\n\n\n  if (nodes.length === 1 && nodes[0] === null) {\n    nodes = [];\n    moves.push({\n      index: nodes.length,\n      type: REPLACE\n    });\n  }\n\n\n  newList.forEach((item, i) => {\n    item = utils.isArray(item) ? item[0] : item;\n    let nodeItem = nodes[i];\n    if (nodeItem) {\n      // 有key的情况\n    } else {\n      moves.push({\n        type: 'REORDER',\n        item,\n        index: i\n      });\n    }\n  });\n\n  // console.log('diffList nodes', nodes);\n  // console.log('diffList moves', moves);\n\n  return {\n    moves,\n    nodes\n  }\n}\n\nfunction diffProps(props, newProps) {\n  let propsPatches = {};\n\n  for (const key in props) {\n    if (newProps.hasOwnProperty(key) && newProps[key] !== props[key]) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  for (const key in newProps) {\n    if (!props.hasOwnProperty(key)) {\n      propsPatches[key] = newProps[key];\n    }\n  }\n\n  return propsPatches;\n}\n\nexport default diff;\n","import utils from './utils';\nimport { REMOVE, INSERT, PROPS, TEXT, REPLACE, REORDER } from './constants';\nimport createElement from './create_element';\n\n/**\n * patch 根据 diff 的结果对差异进行更新\n * @param {*} root HTML rootNode generated by vnode\n * @param {*} patches\n */\nfunction patch(root, patches) {\n  let index = 0;\n\n  patchNode(root, patches, index);\n}\n\nfunction patchNode(node, patches, index) {\n  let currentPatch = patches[index] || [];\n\n  currentPatch.forEach((patch, i) => {\n    switch(patch.type) {\n      case INSERT:\n        // console.log(node, patch, 'insert');\n        // console.log(patch.node);\n        break;\n      case REMOVE:\n        // console.log(node, patch, 'remove');\n        node.parentNode.removeChild(node);\n        break;\n      case REPLACE:\n        // console.log(node, patch.node, 'replace');\n        let newNode = createElement(patch.node);\n        node.parentNode.replaceChild(newNode, node);\n        break;\n      case REORDER:\n        // console.log(node, patch, 'reorder');\n        reorderChildren(node, patch.moves);\n        break;\n      case PROPS:\n        // console.log(node, patch.props, 'props');\n        utils.setAttrs(node, patch.props);\n        break;\n      case TEXT:\n        // console.log(node, patch, 'text');\n        // console.log(node.parentNode);\n        node.parentNode.textContent = patch.content;\n        // utils.setAttrs(node, patch.props);\n        break;\n    }\n  });\n\n  node.childNodes.forEach((node, i) => {\n    index++;\n    // console.log(node);\n    patchNode(node, patches, i + index);\n  });\n\n}\n\nfunction reorderChildren(node, moves) {\n  // console.log(node.childNodes);\n  const nodeList = [].slice.call(node.childNodes);\n  // console.log(nodeList);\n  moves.forEach(move => {\n    let index = move.index;\n    // console.log(move.index);\n    // console.log(node);\n    if (move.type === REPLACE) {\n      // console.log(index, nodeList[index], node.childNodes[index]);\n      if (nodeList[index] === node.childNodes[index]) {\n        // console.log(move.index);\n        // console.log(nodeList[index], node.childNodes[index]);\n        node.removeChild(node.childNodes[index]);\n      }\n      nodeList.splice(index, 1);\n    } else if (move.type === REORDER) {\n      let insertNode = utils.isObject(move.item)\n        ? createElement(move.item)\n        : document.createTextNode(move.item);\n\n      // console.log('insertNode: ');\n      // console.log(insertNode);\n      // console.log(node.childNodes[move.index]);\n      nodeList.splice(index, 0, insertNode);\n      node.insertBefore(insertNode, node.childNodes[index] || null);\n    }\n  });\n}\n\nexport default patch;\n","import {\n  createVNode,\n  createElement,\n  render,\n  diff,\n  patch\n} from './index';\n\n// jsx 被 babel 编译后的格式\n// let vtree = createVNode('div', { id: 'box' },\n//   createVNode('p', { className: 'message', style: { color: '#36f' } }, 'hello walker'),\n//   createVNode('ul', { className: 'lists' },\n//     createVNode('li', null, 'Item 1'),\n//     createVNode('li', null, 'Item 2'),\n//     createVNode('li', null, 'Item 3')\n//   )\n// );\n\n// 这里使用 @babel/plugin-transform-react-jsx 解析\n// 只需实现 createVNode 即可，名称可以自定义\nlet vtree = (\n  <div id=\"box\">\n    <p className=\"message\" style={{color: '#36f'}}>hello walker</p>\n    <ul className=\"lists\">\n      <li>Item 1</li>\n      <li>Item 2</li>\n      <li>Item 3</li>\n    </ul>\n  </div>\n);\n// vtree = null;\n\nconsole.log('vtree: ', vtree);\n\nlet rootNode = createElement(vtree);\n\nconsole.log('rootNode: ', rootNode);\n\nrender(rootNode, document.getElementById('app'));\n\n\n// let newVtree = createVNode('div', { className: 'new-box', id: 'box' },\n//   createVNode('h1', { id: 'title' }, 'This is title'),\n//   createVNode('p', { style: { color: '#f80' } }, 'hello walker, nice to meet you'),\n//   createVNode('ul', { className: 'lists new-lists' },\n//     createVNode('li', null, 'Item 1'),\n//     createVNode('li', null, 'Item 4'),\n//   )\n// );\n\n\n// let newVtree = (\n//   <div id=\"box\" className=\"new-box\">\n\n//     <p style={{color: '#f80'}}>hello walker, nick to meet you</p>\n\n//   </div>\n// );\n\n\n/*\nlet newVtree = (\n  <div id=\"box\" className=\"new-box\">\n    <h1 id=\"title\">This is title</h1>\n    <p style={{color: '#f80'}}>hello walker, nick to meet you</p>\n    <ul className=\"lists new-lists\">\n      <li>Item 1</li>\n      <li>Item 4</li>\n    </ul>\n  </div>\n);\n\nlet patches = diff(vtree, newVtree);\n\nconsole.log('patches: ', patches);\n\npatch(rootNode, patches);\n*/\n\n\n// test jsx\n// let vdom1 = (\n//   <div class=\"box\">\n//     <p>1</p>\n//     <span>666</span>\n//     <ul>\n//       <li>item1</li>\n//       <li>item1</li>\n//       <li>item1</li>\n//     </ul>\n//   </div>\n// );\n// console.log(vdom1);\n\n\n\nlet count = 0;\n\nfunction createVtree() {\n\n  let items = [];\n\n  for(let i = 0; i < count; i++) {\n    // items.push(createVNode('li', null, `Item ${i}`));\n    items.push(<li>{ 'Item ' + i }</li>);\n  }\n\n  let color = (count % 2 === 0) ? '#36f': '#f80';\n\n  return (\n    <div id=\"box\" className=\"new-box\">\n      <h1 id=\"title\">This is title</h1>\n      some text\n      <p style={{color: color}}>hello walker, nick to meet you</p>\n      <ul className=\"lists new-lists\">\n        {items}\n      </ul>\n    </div>\n  );\n  // return createVNode('div', { className: 'new-box', id: 'box' },\n  //   createVNode('h1', { id: 'title' }, 'This is title'),\n  //   createVNode('p', { style: { color: color } }, `hello walker, nice to meet you ${count}`),\n  //   createVNode('ul', { className: 'lists new-lists' }, ...items)\n  // );\n}\n\nfunction renderTest() {\n  let newVtree = createVtree();\n  let patches = diff(vtree, newVtree);\n  // console.log(vtree, newVtree);\n  console.log('patches: ', patches);\n  patch(rootNode, patches);\n  vtree = newVtree;\n}\n\n\ndocument.getElementById('btn-start').onclick = function () {\n  count = 0;\n  renderTest();\n};\n\ndocument.getElementById('btn-add').onclick = function () {\n  count++;\n  renderTest();\n};\n\ndocument.getElementById('btn-remove').onclick = function () {\n  count--;\n  if (count < 0) count = 0;\n  renderTest();\n};\n"],"names":["utils","isType","type","target","Object","prototype","toString","call","forEach","setAttrs","el","props","key","indexOf","setAttribute","p","style","createVNode","children","length","isArray","vnode","createElement","isNull","document","createTextNode","isString","appendChild","bind","map","render","vdom","REMOVE","INSERT","REPLACE","REORDER","PROPS","TEXT","diff","tree","newTree","index","patches","diffNode","oldNode","newNode","currentPatch","push","content","propsPatches","diffProps","keys","diffChildren","node","oldChildren","newChildren","diffs","diffList","moves","nodes","i","oldList","newList","item","newItem","splice","nodeItem","newProps","hasOwnProperty","patch","root","patchNode","parentNode","removeChild","replaceChild","reorderChildren","textContent","childNodes","nodeList","slice","move","insertNode","isObject","insertBefore","vtree","color","console","log","rootNode","getElementById","count","createVtree","items","renderTest","newVtree","onclick"],"mappings":";;;;;EAAA,IAAIA,KAAK,GAAG,EAAZ;;EAEAA,KAAK,CAACC,MAAN,GAAe,CAACC,IAAD,EAAOC,MAAP,KAAkB;EAC/B,SAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,MAA/B,MAA4C,WAAUD,IAAK,GAAlE;EACD,CAFD;;EAIA,CAAC,QAAD,EAAW,SAAX,EAAsB,QAAtB,EAAgC,OAAhC,EAAyC,UAAzC,EAAqD,QAArD,EAA+D,MAA/D,EAAuE,QAAvE,EAAiF,OAAjF,EAA0F,MAA1F,EAAkGM,OAAlG,CAA0GN,IAAI,IAAI;EAChHF,EAAAA,KAAK,CAAE,KAAIE,IAAK,EAAX,CAAL,GAAsBC,MAAD,IAAYH,KAAK,CAACC,MAAN,CAAaC,IAAb,EAAmBC,MAAnB,CAAjC;EACD,CAFD;EAMA;EACA;;EACAH,KAAK,CAACS,QAAN,GAAiB,CAACC,EAAD,EAAKC,KAAL,KAAe;EAC9B,OAAK,IAAIC,GAAT,IAAgBD,KAAhB,EAAuB;EACrB,QAAI,CAAC,IAAD,EAAO,MAAP,EAAe,OAAf,EAAwBE,OAAxB,CAAgCD,GAAhC,MAAyC,CAAC,CAA9C,EAAiD;EAC/CF,MAAAA,EAAE,CAACI,YAAH,CAAgBF,GAAhB,EAAqBD,KAAK,CAACC,GAAD,CAA1B;EACD;;EACD,QAAIA,GAAG,KAAK,WAAZ,EAAyB;EACvBF,MAAAA,EAAE,CAACI,YAAH,CAAgB,OAAhB,EAAyBH,KAAK,CAAC,WAAD,CAA9B;EACD;;EACD,QAAIC,GAAG,KAAK,OAAZ,EAAqB;EACnB,WAAK,IAAIG,CAAT,IAAcJ,KAAK,CAACK,KAApB,EAA2B;EACzBN,QAAAA,EAAE,CAACM,KAAH,CAASD,CAAT,IAAcJ,KAAK,CAACK,KAAN,CAAYD,CAAZ,CAAd;EACD;EACF;EACF;EACF,CAdD;;ECdA;AACA;EAKA,SAASE,WAAT,CAAqBf,IAArB,EAA2BS,KAA3B,EAAkC,GAAGO,QAArC,EAA+C;EAE7C;EACA;EACA,MAAIA,QAAQ,CAACC,MAAT,KAAoB,CAApB,IAAyBnB,KAAK,CAACoB,OAAN,CAAcF,QAAQ,CAAC,CAAD,CAAtB,CAA7B,EAAyD;EACvDA,IAAAA,QAAQ,GAAG,CAACA,QAAQ,CAAC,CAAD,CAAR,CAAYC,MAAb,GAAsB,EAAtB,GAA2BD,QAAQ,CAAC,CAAD,CAA9C;EACD;;EAED,MAAIG,KAAK,GAAG;EACVT,IAAAA,GAAG,EAAGD,KAAK,IAAIA,KAAK,CAACC,GAAhB,IAAwB,IADnB;EAEVV,IAAAA,IAAI,EAAEA,IAFI;EAGVS,IAAAA,KAAK,EAAEA,KAAK,GAAGA,KAAH,GAAW,EAHb;EAIVO,IAAAA;EAJU,GAAZ;EAOA,SAAOG,KAAP;EACD;;ECnBD,SAASC,aAAT,CAAuBD,KAAvB,EAA8B;EAC5B,MAAIrB,KAAK,CAACuB,MAAN,CAAaF,KAAb,CAAJ,EAAyB;EACvB,WAAOG,QAAQ,CAACC,cAAT,CAAwB,EAAxB,CAAP;EACD;;EAED,MAAI;EAAEvB,IAAAA,IAAF;EAAQS,IAAAA,KAAR;EAAeO,IAAAA;EAAf,MAA4BG,KAAhC,CAL4B;EAQ5B;EACA;EACA;;EAEA,MAAIrB,KAAK,CAAC0B,QAAN,CAAeL,KAAf,CAAJ,EAA2B;EACzB,WAAOG,QAAQ,CAACC,cAAT,CAAwBJ,KAAxB,CAAP;EACD;;EAED,MAAIX,EAAE,GAAGc,QAAQ,CAACF,aAAT,CAAuBpB,IAAvB,CAAT;EACAF,EAAAA,KAAK,CAACS,QAAN,CAAeC,EAAf,EAAmBC,KAAnB;;EAEA,MAAI,CAACO,QAAL,EAAe;EACb,WAAOR,EAAP;EACD,GArB2B;EAwB5B;EACA;EACA;EAEA;;;EACA,MAAIiB,WAAW,GAAGjB,EAAE,CAACiB,WAAH,CAAeC,IAAf,CAAoBlB,EAApB,CAAlB;EACAQ,EAAAA,QAAQ,CAACW,GAAT,CAAaP,aAAb,EAA4BO,GAA5B,CAAgCF,WAAhC;EAEA,SAAOjB,EAAP;EACD;;ECpCD,SAASoB,MAAT,CAAgBC,IAAhB,EAAsBrB,EAAtB,EAA0B;EACxBA,EAAAA,EAAE,CAACiB,WAAH,CAAeI,IAAf;EACD;;ECFD;AACA,EAAO,MAAMC,MAAM,GAAG,QAAf;;AAGP,EAAO,MAAMC,MAAM,GAAG,QAAf;;AAGP,EAAO,MAAMC,OAAO,GAAG,SAAhB;;AAGP,EAAO,MAAMC,OAAO,GAAG,SAAhB;;AAGP,EAAO,MAAMC,KAAK,GAAG,OAAd;;AAGP,EAAO,MAAMC,IAAI,GAAG,MAAb;;ECbP,SAASC,IAAT,CAAcC,IAAd,EAAoBC,OAApB,EAA6B;EAC3B;EACA,MAAIC,KAAK,GAAG,CAAZ;EACA,MAAIC,OAAO,GAAG,EAAd;EAEA,SAAOC,QAAQ,CAACJ,IAAD,EAAOC,OAAP,EAAgBC,KAAhB,EAAuBC,OAAvB,CAAf;EACD;;EAED,SAASC,QAAT,CAAkBC,OAAlB,EAA2BC,OAA3B,EAAoCJ,KAApC,EAA2CC,OAA3C,EAAoD;EAClD;EACA,MAAII,YAAY,GAAG,EAAnB,CAFkD;;EAMlD,MAAI,CAACD,OAAL,EAAc,CAAd,MAKO,IAAI7C,KAAK,CAAC0B,QAAN,CAAekB,OAAf,KAA2B5C,KAAK,CAAC0B,QAAN,CAAemB,OAAf,CAA/B,EAAwD;EAC7D,QAAID,OAAO,KAAKC,OAAhB,EAAyB;EACvBC,MAAAA,YAAY,CAACC,IAAb,CAAkB;EAChB7C,QAAAA,IAAI,EAAEmC,IADU;EAEhBW,QAAAA,OAAO,EAAEH;EAFO,OAAlB;EAID;EACF,GAPM,MAOA,IAAID,OAAO,IAAIC,OAAX,IAAsBD,OAAO,CAAC1C,IAAR,KAAiB2C,OAAO,CAAC3C,IAA/C,IAAuD0C,OAAO,CAAChC,GAAR,KAAgBiC,OAAO,CAACjC,GAAnF,EAAwF;EAC7F,QAAIqC,YAAY,GAAGC,SAAS,CAACN,OAAO,CAACjC,KAAT,EAAgBkC,OAAO,CAAClC,KAAxB,CAA5B;;EAEA,QAAIP,MAAM,CAAC+C,IAAP,CAAYF,YAAZ,EAA0B9B,MAA9B,EAAsC;EACpC2B,MAAAA,YAAY,CAACC,IAAb,CAAkB;EAChB7C,QAAAA,IAAI,EAAEkC,KADU;EAEhBzB,QAAAA,KAAK,EAAEsC;EAFS,OAAlB;EAID,KAR4F;EAW7F;;;EACAG,IAAAA,YAAY,CAACR,OAAO,CAAC1B,QAAT,EAAmB2B,OAAO,CAAC3B,QAA3B,EAAqCuB,KAArC,EAA4CC,OAA5C,EAAqDI,YAArD,CAAZ;EAED,GAdM,MAcA;EACLA,IAAAA,YAAY,CAACC,IAAb,CAAkB;EAChB7C,MAAAA,IAAI,EAAEgC,OADU;EAEhBmB,MAAAA,IAAI,EAAER;EAFU,KAAlB;EAID,GArCiD;;;EAyClD,MAAIC,YAAY,CAAC3B,MAAjB,EAAyB;EACvB;EACAuB,IAAAA,OAAO,CAACD,KAAD,CAAP,GAAiBK,YAAjB;EACD;;EAED,SAAOJ,OAAP;EACD;;EAED,SAASU,YAAT,CAAsBE,WAAtB,EAAmCC,WAAnC,EAAgDd,KAAhD,EAAuDC,OAAvD,EAAgEI,YAAhE,EAA8E;EAC5E;EACA,MAAIU,KAAK,GAAGC,QAAQ,CAACH,WAAD,EAAcC,WAAd,CAApB,CAF4E;;EAM5E,MAAIC,KAAK,CAACE,KAAN,CAAYvC,MAAhB,EAAwB;EACtB2B,IAAAA,YAAY,CAACC,IAAb,CAAkB;EAChB7C,MAAAA,IAAI,EAAEiC,OADU;EAEhBuB,MAAAA,KAAK,EAAEF,KAAK,CAACE;EAFG,KAAlB;EAID;;EAEDH,EAAAA,WAAW,GAAGC,KAAK,CAACG,KAApB;AAEA;EACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,WAAW,CAACnC,MAAhB,IAA0ByC,CAAC,GAAGL,WAAW,CAACpC,MAA1D,EAAkEyC,CAAC,EAAnE,EAAuE;EACrE,QAAIhB,OAAO,GAAGU,WAAW,CAACM,CAAD,CAAzB;EACA,QAAIf,OAAO,GAAGU,WAAW,CAACK,CAAD,CAAzB,CAFqE;EAIrE;;EACAnB,IAAAA,KAAK;EACLE,IAAAA,QAAQ,CAACC,OAAD,EAAUC,OAAV,EAAmBe,CAAC,GAAGnB,KAAvB,EAA8BC,OAA9B,CAAR;EACD;EACF;;EAED,SAASe,QAAT,CAAkBI,OAAlB,EAA2BC,OAA3B,EAAoC;EAClC,MAAIJ,KAAK,GAAG,EAAZ;EACA,MAAIC,KAAK,GAAG,EAAZ;EAEAE,EAAAA,OAAO,CAACrD,OAAR,CAAgB,CAACuD,IAAD,EAAOH,CAAP,KAAa;EAC3B,QAAII,OAAO,GAAGF,OAAO,CAACF,CAAD,CAAP,IAAc,IAA5B;EACAD,IAAAA,KAAK,CAACZ,IAAN,CAAWiB,OAAX;EACD,GAHD,EAJkC;EAWlC;;EACAL,EAAAA,KAAK,CAACnD,OAAN,CAAc,CAAC6C,IAAD,EAAOO,CAAP,KAAa;EACzB,QAAIP,IAAI,KAAK,IAAb,EAAmB;EACjBK,MAAAA,KAAK,CAACX,IAAN,CAAW;EACTN,QAAAA,KAAK,EAAEmB,CADE;EAET1D,QAAAA,IAAI,EAAEgC;EAFG,OAAX;EAIAyB,MAAAA,KAAK,CAACM,MAAN,CAAaL,CAAb,EAAgB,CAAhB;EACD;EACF,GARD;;EAWA,MAAID,KAAK,CAACxC,MAAN,KAAiB,CAAjB,IAAsBwC,KAAK,CAAC,CAAD,CAAL,KAAa,IAAvC,EAA6C;EAC3CA,IAAAA,KAAK,GAAG,EAAR;EACAD,IAAAA,KAAK,CAACX,IAAN,CAAW;EACTN,MAAAA,KAAK,EAAEkB,KAAK,CAACxC,MADJ;EAETjB,MAAAA,IAAI,EAAEgC;EAFG,KAAX;EAID;;EAGD4B,EAAAA,OAAO,CAACtD,OAAR,CAAgB,CAACuD,IAAD,EAAOH,CAAP,KAAa;EAC3BG,IAAAA,IAAI,GAAG/D,KAAK,CAACoB,OAAN,CAAc2C,IAAd,IAAsBA,IAAI,CAAC,CAAD,CAA1B,GAAgCA,IAAvC;EACA,QAAIG,QAAQ,GAAGP,KAAK,CAACC,CAAD,CAApB;;EACA,QAAIM,QAAJ,EAAc,CAAd,MAEO;EACLR,MAAAA,KAAK,CAACX,IAAN,CAAW;EACT7C,QAAAA,IAAI,EAAE,SADG;EAET6D,QAAAA,IAFS;EAGTtB,QAAAA,KAAK,EAAEmB;EAHE,OAAX;EAKD;EACF,GAZD,EAhCkC;EA+ClC;;EAEA,SAAO;EACLF,IAAAA,KADK;EAELC,IAAAA;EAFK,GAAP;EAID;;EAED,SAAST,SAAT,CAAmBvC,KAAnB,EAA0BwD,QAA1B,EAAoC;EAClC,MAAIlB,YAAY,GAAG,EAAnB;;EAEA,OAAK,MAAMrC,GAAX,IAAkBD,KAAlB,EAAyB;EACvB,QAAIwD,QAAQ,CAACC,cAAT,CAAwBxD,GAAxB,KAAgCuD,QAAQ,CAACvD,GAAD,CAAR,KAAkBD,KAAK,CAACC,GAAD,CAA3D,EAAkE;EAChEqC,MAAAA,YAAY,CAACrC,GAAD,CAAZ,GAAoBuD,QAAQ,CAACvD,GAAD,CAA5B;EACD;EACF;;EAED,OAAK,MAAMA,GAAX,IAAkBuD,QAAlB,EAA4B;EAC1B,QAAI,CAACxD,KAAK,CAACyD,cAAN,CAAqBxD,GAArB,CAAL,EAAgC;EAC9BqC,MAAAA,YAAY,CAACrC,GAAD,CAAZ,GAAoBuD,QAAQ,CAACvD,GAAD,CAA5B;EACD;EACF;;EAED,SAAOqC,YAAP;EACD;;ECzJD;;;;;;EAKA,SAASoB,KAAT,CAAeC,IAAf,EAAqB5B,OAArB,EAA8B;EAC5B,MAAID,KAAK,GAAG,CAAZ;EAEA8B,EAAAA,SAAS,CAACD,IAAD,EAAO5B,OAAP,EAAgBD,KAAhB,CAAT;EACD;;EAED,SAAS8B,SAAT,CAAmBlB,IAAnB,EAAyBX,OAAzB,EAAkCD,KAAlC,EAAyC;EACvC,MAAIK,YAAY,GAAGJ,OAAO,CAACD,KAAD,CAAP,IAAkB,EAArC;EAEAK,EAAAA,YAAY,CAACtC,OAAb,CAAqB,CAAC6D,KAAD,EAAQT,CAAR,KAAc;EACjC,YAAOS,KAAK,CAACnE,IAAb;EACE,WAAK+B,MAAL;EACE;EACA;EACA;;EACF,WAAKD,MAAL;EACE;EACAqB,QAAAA,IAAI,CAACmB,UAAL,CAAgBC,WAAhB,CAA4BpB,IAA5B;EACA;;EACF,WAAKnB,OAAL;EACE;EACA,YAAIW,OAAO,GAAGvB,aAAa,CAAC+C,KAAK,CAAChB,IAAP,CAA3B;EACAA,QAAAA,IAAI,CAACmB,UAAL,CAAgBE,YAAhB,CAA6B7B,OAA7B,EAAsCQ,IAAtC;EACA;;EACF,WAAKlB,OAAL;EACE;EACAwC,QAAAA,eAAe,CAACtB,IAAD,EAAOgB,KAAK,CAACX,KAAb,CAAf;EACA;;EACF,WAAKtB,KAAL;EACE;EACApC,QAAAA,KAAK,CAACS,QAAN,CAAe4C,IAAf,EAAqBgB,KAAK,CAAC1D,KAA3B;EACA;;EACF,WAAK0B,IAAL;EACE;EACA;EACAgB,QAAAA,IAAI,CAACmB,UAAL,CAAgBI,WAAhB,GAA8BP,KAAK,CAACrB,OAApC,CAHF;;EAKE;EA3BJ;EA6BD,GA9BD;EAgCAK,EAAAA,IAAI,CAACwB,UAAL,CAAgBrE,OAAhB,CAAwB,CAAC6C,IAAD,EAAOO,CAAP,KAAa;EACnCnB,IAAAA,KAAK,GAD8B;;EAGnC8B,IAAAA,SAAS,CAAClB,IAAD,EAAOX,OAAP,EAAgBkB,CAAC,GAAGnB,KAApB,CAAT;EACD,GAJD;EAMD;;EAED,SAASkC,eAAT,CAAyBtB,IAAzB,EAA+BK,KAA/B,EAAsC;EACpC;EACA,QAAMoB,QAAQ,GAAG,GAAGC,KAAH,CAASxE,IAAT,CAAc8C,IAAI,CAACwB,UAAnB,CAAjB,CAFoC;;EAIpCnB,EAAAA,KAAK,CAAClD,OAAN,CAAcwE,IAAI,IAAI;EACpB,QAAIvC,KAAK,GAAGuC,IAAI,CAACvC,KAAjB,CADoB;EAGpB;;EACA,QAAIuC,IAAI,CAAC9E,IAAL,KAAcgC,OAAlB,EAA2B;EACzB;EACA,UAAI4C,QAAQ,CAACrC,KAAD,CAAR,KAAoBY,IAAI,CAACwB,UAAL,CAAgBpC,KAAhB,CAAxB,EAAgD;EAC9C;EACA;EACAY,QAAAA,IAAI,CAACoB,WAAL,CAAiBpB,IAAI,CAACwB,UAAL,CAAgBpC,KAAhB,CAAjB;EACD;;EACDqC,MAAAA,QAAQ,CAACb,MAAT,CAAgBxB,KAAhB,EAAuB,CAAvB;EACD,KARD,MAQO,IAAIuC,IAAI,CAAC9E,IAAL,KAAciC,OAAlB,EAA2B;EAChC,UAAI8C,UAAU,GAAGjF,KAAK,CAACkF,QAAN,CAAeF,IAAI,CAACjB,IAApB,IACbzC,aAAa,CAAC0D,IAAI,CAACjB,IAAN,CADA,GAEbvC,QAAQ,CAACC,cAAT,CAAwBuD,IAAI,CAACjB,IAA7B,CAFJ,CADgC;EAMhC;EACA;;EACAe,MAAAA,QAAQ,CAACb,MAAT,CAAgBxB,KAAhB,EAAuB,CAAvB,EAA0BwC,UAA1B;EACA5B,MAAAA,IAAI,CAAC8B,YAAL,CAAkBF,UAAlB,EAA8B5B,IAAI,CAACwB,UAAL,CAAgBpC,KAAhB,KAA0B,IAAxD;EACD;EACF,GAvBD;EAwBD;;EC7ED;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;;EACA,IAAI2C,KAAK,GACP;EAAK,EAAA,EAAE,EAAC;EAAR,GACE;EAAG,EAAA,SAAS,EAAC,SAAb;EAAuB,EAAA,KAAK,EAAE;EAACC,IAAAA,KAAK,EAAE;EAAR;EAA9B,kBADF,EAEE;EAAI,EAAA,SAAS,EAAC;EAAd,GACE,iCADF,EAEE,iCAFF,EAGE,iCAHF,CAFF,CADF;;EAYAC,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBH,KAAvB;EAEA,IAAII,QAAQ,GAAGlE,aAAa,CAAC8D,KAAD,CAA5B;EAEAE,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BC,QAA1B;EAEA1D,MAAM,CAAC0D,QAAD,EAAWhE,QAAQ,CAACiE,cAAT,CAAwB,KAAxB,CAAX,CAAN;EAIA;EACA;EACA;EACA;EACA;EACA;EACA;EAGA;EACA;EAEA;EAEA;EACA;;EAGA;;;;;;;;;;;;;;;;;;EAoBA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAIA,IAAIC,KAAK,GAAG,CAAZ;;EAEA,SAASC,WAAT,GAAuB;EAErB,MAAIC,KAAK,GAAG,EAAZ;;EAEA,OAAI,IAAIhC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG8B,KAAnB,EAA0B9B,CAAC,EAA3B,EAA+B;EAC7B;EACAgC,IAAAA,KAAK,CAAC7C,IAAN,CAAW,wBAAM,UAAUa,CAAhB,CAAX;EACD;;EAED,MAAIyB,KAAK,GAAIK,KAAK,GAAG,CAAR,KAAc,CAAf,GAAoB,MAApB,GAA4B,MAAxC;EAEA,SACE;EAAK,IAAA,EAAE,EAAC,KAAR;EAAc,IAAA,SAAS,EAAC;EAAxB,KACE;EAAI,IAAA,EAAE,EAAC;EAAP,qBADF,eAGE;EAAG,IAAA,KAAK,EAAE;EAACL,MAAAA,KAAK,EAAEA;EAAR;EAAV,sCAHF,EAIE;EAAI,IAAA,SAAS,EAAC;EAAd,KACGO,KADH,CAJF,CADF,CAXqB;EAsBrB;EACA;EACA;EACA;EACD;;EAED,SAASC,UAAT,GAAsB;EACpB,MAAIC,QAAQ,GAAGH,WAAW,EAA1B;EACA,MAAIjD,OAAO,GAAGJ,IAAI,CAAC8C,KAAD,EAAQU,QAAR,CAAlB,CAFoB;;EAIpBR,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyB7C,OAAzB;EACA2B,EAAAA,KAAK,CAACmB,QAAD,EAAW9C,OAAX,CAAL;EACA0C,EAAAA,KAAK,GAAGU,QAAR;EACD;;EAGDtE,QAAQ,CAACiE,cAAT,CAAwB,WAAxB,EAAqCM,OAArC,GAA+C,YAAY;EACzDL,EAAAA,KAAK,GAAG,CAAR;EACAG,EAAAA,UAAU;EACX,CAHD;;EAKArE,QAAQ,CAACiE,cAAT,CAAwB,SAAxB,EAAmCM,OAAnC,GAA6C,YAAY;EACvDL,EAAAA,KAAK;EACLG,EAAAA,UAAU;EACX,CAHD;;EAKArE,QAAQ,CAACiE,cAAT,CAAwB,YAAxB,EAAsCM,OAAtC,GAAgD,YAAY;EAC1DL,EAAAA,KAAK;EACL,MAAIA,KAAK,GAAG,CAAZ,EAAeA,KAAK,GAAG,CAAR;EACfG,EAAAA,UAAU;EACX,CAJD;;;;"}